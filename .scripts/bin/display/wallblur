#!/bin/bash
#
# wallblur
# Created by Hayden Hamilton
#
# haydenvh.com
# Copyright (c) 2019 Hayden Hamilton.

backend="xwallpaper"
args="$@"
echo "$args"

[ "$args" == "" ] && args=2
donorm(){
	convert $file -colors $args $1
	files+="$1 "
}
input=$(cat ~/.cache/rfeh/prev)
count=0
files=""
for file in $input
do
	count=$(($count+1))
	donorm "/tmp/screen${count}.png"
done
[ "$backend" = "xwallpaper" ] && {
	files=$(echo "$files" | tr " " "\n" | sed "s~^~--output OUTPUT --zoom ~g" | tr "\n" " ")
	for OUTPUT in $(xrandr --listactivemonitors | awk '$4 {print $4}')
	do
		files=$(echo "$files" | sed "s/OUTPUT/$OUTPUT/")
	done
	xwallpaper $files
} || {
	files=$(echo "$files" | tr " " "\n" | sed "s~^~--bg-fill ~g" | tr "\n" " ")
	feh $files
}
