#!/bin/bash
#
# dmenu/dpass
# Created by Hayden Hamilton
#
# haydenvh.com
# Copyright (c) 2019 Hayden Hamilton. LICENSE:GPLv2 ../../.licenses/gplv2.license
#
dmenu="dmenu"
. $HOME/.dmenurc

[ ! -f $PASS ] && touch $PASS
pass=$(printf "GENERATE\nEDIT\n$(cat $PASS | awk '// {print $1}')" | $dmenu -l 50 -i -p "Select a password/generate/edit:" | tr '[:upper:]' '[:lower:]')
getpass=$(cat $PASS | awk "/$pass/ "'{print $0}')
if [ "$pass" == "" ]
then
	exit 0
elif [ "$pass" == "generate" ]
then
	password=$(head -c 500 /dev/urandom | tr -dc 'a-zA-Z0-9~!@#$%^&*_+=-' | fold -w 30 | head -n 1)
	passname=$(echo "" | $dmenu -l 50 -i -p "Name for password (only 1 word):")
	if [ "$passname" == "" ]
	then
		passname="pleaseeditthis"
	fi
	echo "$passname: $password" >> $PASS
	[ "$(printf "No\nYes" | $dmenu -i -p "Edit the pasword file?")" == "Yes" ] && $TERMINAL -e vim $PASS
elif [ "$pass" == "edit" ]
then
	$TERMINAL -hold -e vim $PASS
else
	echo $getpass | sed "s/$pass.//g" | tr " " "\n" | $dmenu $2 -l 20 -p "Password:" | xclip
	notify-send "Password copied to clipboard."
fi
