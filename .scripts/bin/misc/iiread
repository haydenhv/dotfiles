#!/bin/sh

getout(){
	out=$(find . -type f -name "*out")
}

refresh(){
	getout
	for line in $out
	do
		name=$(echo "$line" | sed 's/out$//;s~/$~~;s~.*/~~')
		awk "{print \"[$name] \" \$0}" < $line
		cp $line /dev/stdout > $(echo "$line" | sed 's/out$/old/')
		printf "" > $line
	done
}

quit(){
	read -n 1 -s var < /dev/tty
	pkill iiread
}

clear
quit &
while true
do
	refresh
	sleep 0.5
done
