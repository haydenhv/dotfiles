#!/bin/bash

array=$(cat /dev/stdin | awk '/http/' | sed 's/.*http/http/g' | awk '{print $1}' | sort)

clear
count=0
IFS=$'\n'
printf "" > ~/.cache/urlhand1
for link in $array
do
	count=$(($count+1))
	echo "$count: $link"
	echo "$count:$link" | sed 's|/|\t|g' >> ~/.cache/urlhand1
done

printf "\nSelect a number: "; read var < /dev/tty
arg=$(grep "$var:" < ~/.cache/urlhand1 | sed 's|\t|/|g' | sed 's/^[0-9]*://')
handlers=("mpv" "youtube-dl --add-metadata -ic" "youtube-dl --add-metadata -xic" "vimb --no-maximize" "surf" "w3m")
count=0
echo
printf "" > ~/.cache/urlhand2
for item in ${!handlers[*]}
do
	count=$(($count+1))
	echo "$count: ${handlers[$item]}"
	echo "$count:${handlers[$item]}" | sed 's|/|\t|g' >> ~/.cache/urlhand2
done

printf "\nSelect a handler: "; read var < /dev/tty
hand=$(grep "$var:" < ~/.cache/urlhand2 | sed 's|\t|/|g' | sed 's/^[0-9]*://')
killall mpvlisten
hmpv pause /tmp/mpv-socket
hmpv pause /tmp/mpv-socket2
bash -c "$hand $arg"
mpvlisten /tmp/mpv-socket2 /tmp/mpv-socket &
