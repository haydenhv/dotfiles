#!/bin/bash

link=$(awk '/http/' < /dev/stdin | sed 's/.*http/http/g;s/\[.*\]//g' | awk '{print $1}' | sort | dmenu -i -p "Select a url:")

IFS=$'\n'

hand=$(printf "mpv
popupmpv
youtube-dl --add-metadata -ic
youtube-dl --add-metadata -xic
vimb --no-maximize" | dmenu -i -p "Select a handler:")

pkill mpvlisten
hmpv pause /tmp/mpv-socket
hmpv pause /tmp/mpv-socket2
sh -c "$hand $link"
mpvlisten /tmp/mpv-socket2 /tmp/mpv-socket &
